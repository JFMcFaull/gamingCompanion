<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games List</title>
    <link rel="stylesheet" href="gamesLibrary.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>
    <div id="header" class="header">
        <a href="homepage.html" class="back-button">Home</a>
        <h1>Loading Progress...</h1>
        <div class="header-content">
            <!-- Filter box -->
            <div id="filterBox">
                <label for="filterInput">Filter by Title:</label>
                <input type="text" id="filterInput" oninput="filterGames()">
            </div>
        </div>
    </div>

    <div id="gamesList"></div>

    <script>
        async function fetchGames() {
            try {
                const response = await fetch('http://localhost:3000/games');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                let data = await response.json();

                // Log the received data
                console.log('Data received from server:', data);

                // Extract the games array from the response data
                let games = data.games;

                // Log the extracted games array
                console.log('Extracted games array:', games);

                displayGames(games);
            } catch (error) {
                console.error('Error fetching games:', error);
                // Optionally, display an error message or handle retries
            }
        }

        function displayGames(games) {
            console.log('Games received for display:', games); // Check what games actually contains

            const gamesList = document.getElementById('gamesList');
            gamesList.innerHTML = '<h2>Gaming Library</h2><p></p>';

            if (Array.isArray(games)) {
                games.forEach(game => {
                    // Log each game object
                    console.log('Game object:', game);

                    const gameElement = document.createElement('div');
                    gameElement.classList.add('game');

                    // Check if the platform is empty and provide a default message if it is
                    const platformText = game.Platform ? game.Platform : 'Unknown';

                    // Construct the URL to the specific game record
                    const gameUrl = `gameDetails.html?id=${game.ID}`; // Update with actual game details page URL

                    // Calculate percentage of completed main quests
                    const mainQuests = game.MainQuests;
                    const completedMainQuests = game.CompletedMainQuests;
                    const completionPercentage = (completedMainQuests / mainQuests) * 100;

                    // Determine image based on completion percentage
                    let imageSrc = '';
                    if (completionPercentage >= 80) {
                        imageSrc = 'Assets/Hearts/Hundred.png'; // Image for 80-100%
                    } else if (completionPercentage >= 60) {
                        imageSrc = 'Assets/Hearts/Eighty.png'; // Image for 60-79%
                    } else if (completionPercentage >= 40) {
                        imageSrc = 'Assets/Hearts/Sixty.png'; // Image for 40-59%
                    } else if (completionPercentage >= 20) {
                        imageSrc = 'Assets/Hearts/Forty.png'; // Image for 20-39%
                    } else {
                        imageSrc = 'Assets/Hearts/Zero.png'; // Image for 0-19% (assuming this range)
                    }

                    gameElement.innerHTML = `
                        <div class="game-details">
                            <h3><a href="${gameUrl}">${game.Title}</a></h3>
                            <p>Franchise: ${game.Franchise}</p>
                            <p>Platform: ${platformText}</p>
                            <p>Completion Percentage: ${completionPercentage.toFixed(2)}%</p>
                        </div>
                        <img src="${imageSrc}" alt="Completion Image" class="life-hearts">
                        <hr>
                    `;
                    gamesList.appendChild(gameElement);
                });
            } else {
                console.error('Expected an array of games, but received:', games);
            }
        }

        function filterGames() {
            const filterValue = document.getElementById('filterInput').value.toUpperCase();
            const gameElements = document.querySelectorAll('.game');

            gameElements.forEach(element => {
                const title = element.querySelector('h3').innerText.toUpperCase();
                if (title.includes(filterValue)) {
                    element.style.display = 'block'; // Show game if title matches filter
                } else {
                    element.style.display = 'none'; // Hide game if title does not match filter
                }
            });
        }

        // Fetch games when the page loads
        fetchGames();
    </script>
</body>

</html>
